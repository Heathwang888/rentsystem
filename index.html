<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>手機租賃後台系統</title>
  <style>
    body { margin: 0; font-family: 'Noto Sans TC', sans-serif; background: #f4f4f4; }
    .sidebar { width: 200px; height: 100vh; background: #333; color: #fff; position: fixed; top: 0; left: 0; display: flex; flex-direction: column; }
    .sidebar button { background: none; border: none; color: #fff; padding: 20px; text-align: left; cursor: pointer; font-size: 16px; }
    .sidebar button:hover { background: #444; }
    .page-content { margin-left: 200px; padding: 20px; }
    .page { display: none; }
    .page.active { display: block; }
    form { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; }
    form label { display: block; margin: 10px 0; }
    input, select { margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #45a049; }
    .filter-bar { margin-bottom: 20px; }
    .filter-bar button { background: #f8f9fa; color: #333; margin-right: 10px; }
    .filter-bar button.active { background: #f3cc00; }
    .customer-card { border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin-bottom: 10px; background: #fff; }
    .card-header { display: flex; flex-direction: column; gap: 6px; }
    .card-top { display: flex; justify-content: space-between; align-items: center; }
    .right-section span { margin-left: 10px; }
    .card-summary { display: flex; gap: 12px; align-items: center; justify-content: space-between; }
    .card-actions button { margin-right: 10px; }
    .note-input { width: 200px; }
    .modal { position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); }
    .modal-content { background-color: #fff; margin: 10% auto; padding: 20px; width: 300px; border-radius: 8px; }
    .close-modal { float: right; cursor: pointer; }
  </style>
</head>
<body>
  <div class="sidebar">
    <button onclick="showPage('dashboard')">📊 總覽</button>
    <button onclick="showPage('list')">📁 客戶列表</button>
    <button onclick="showPage('add')">➕ 新增客戶</button>
    <button onclick="showPage('edit')">✏️ 編輯客戶</button>
    <button onclick="showPage('contract')">📄 合約產製</button>
  </div>

  <div class="page-content">
    <div id="dashboard" class="page active">
      <h2>總覽</h2>
      <div class="dashboard-stats">
        <div class="stat-card">
          <h3>總客戶數</h3>
          <p class="stat-number">0</p>
        </div>
        <div class="stat-card">
          <h3>租賃中</h3>
          <p class="stat-number">0</p>
        </div>
        <div class="stat-card">
          <h3>已買回</h3>
          <p class="stat-number">0</p>
        </div>
        <div class="stat-card">
          <h3>呆帳</h3>
          <p class="stat-number">0</p>
        </div>
      </div>
    </div>

    <div id="list" class="page">
      <h2>客戶列表</h2>
      <div class="filter-bar">
        <button class="active">全部</button>
        <button>今日須繳款</button>
        <button>已買回</button>
        <button>呆帳鎖機</button>
      </div>
      <div class="search-box">
        <input type="text" placeholder="搜尋客戶...">
      </div>
      <div class="customer-cards">
        <!-- 客戶卡片將由 JavaScript 動態生成 -->
      </div>
      <div class="pagination">
        <!-- 分頁按鈕將由 JavaScript 動態生成 -->
      </div>
    </div>

    <div id="add" class="page">
      <h2>新增客戶</h2>
      <div class="customer-form">
        <div class="form-header">
          <h3>新增客戶</h3>
        </div>

        <form id="uploadForm" class="form-section active">
          <div class="form-grid">
            <!-- 基本資料 -->
            <div class="form-group">
              <label>姓名</label>
              <input type="text" name="name" placeholder="請輸入姓名" required>
            </div>
            <div class="form-group">
              <label>身分證字號</label>
              <input type="text" name="idNumber" placeholder="請輸入身分證字號" required>
            </div>
            <div class="form-group">
              <label>手機號碼</label>
              <input type="tel" name="phone" placeholder="請輸入手機號碼" required>
            </div>
            <div class="form-group">
              <label>戶籍地址</label>
              <input type="text" name="address" placeholder="請輸入戶籍地址" required>
            </div>
            <div class="form-group">
              <label>通訊地址</label>
              <div class="address-options">
                <input type="text" name="mailingAddress" placeholder="請輸入通訊地址">
                <label class="checkbox-label">
                  <input type="checkbox" name="sameAsResidence" onchange="toggleMailingAddress(this)">
                  同戶籍地址
                </label>
              </div>
            </div>

            <!-- 手機資訊 -->
            <div class="form-group">
              <label>手機型號</label>
              <select name="phoneModel" required>
                <option value="">請選擇型號</option>
                <option>iPhone 12</option>
                <option>iPhone 12 mini</option>
                <option>iPhone 12 Pro</option>
                <option>iPhone 12 Pro Max</option>
                <option>iPhone 13</option>
                <option>iPhone 13 mini</option>
                <option>iPhone 13 Pro</option>
                <option>iPhone 13 Pro Max</option>
                <option>iPhone 14</option>
                <option>iPhone 14 Plus</option>
                <option>iPhone 14 Pro</option>
                <option>iPhone 14 Pro Max</option>
                <option>iPhone 15</option>
                <option>iPhone 15 Plus</option>
                <option>iPhone 15 Pro</option>
                <option>iPhone 15 Pro Max</option>
                <option>iPhone 16</option>
                <option>iPhone 16 e</option>
                <option>iPhone 16 Plus</option>
                <option>iPhone 16 Pro</option>
                <option>iPhone 16 Pro Max</option>
              </select>
            </div>
            <div class="form-group">
              <label>IMEI</label>
              <input type="text" name="imei" placeholder="請輸入IMEI碼" required>
            </div>
            <div class="form-group">
              <label>螢幕密碼</label>
              <input type="text" name="screenPassword" placeholder="請輸入螢幕密碼">
            </div>

            <!-- 合約資訊 -->
            <div class="form-group">
              <label>買賣價金</label>
              <input type="number" name="price" placeholder="請輸入買賣價金" required>
            </div>
            <div class="form-group">
              <label>租金</label>
              <input type="number" name="rent" placeholder="請輸入租金" required>
            </div>
            <div class="form-group">
              <label>合約日期</label>
              <input type="date" name="contractDate" required>
            </div>

            <!-- 文件上傳 -->
            <div class="form-group">
              <label>上傳契約書</label>
              <input type="file" name="contractFile" accept=".pdf,.jpg,.jpeg,.png" required>
            </div>
            <div class="form-group">
              <label>上傳身分證正面</label>
              <input type="file" name="idFront" accept=".jpg,.jpeg,.png" required>
            </div>
            <div class="form-group">
              <label>上傳身分證反面</label>
              <input type="file" name="idBack" accept=".jpg,.jpeg,.png" required>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="button button-primary">儲存</button>
            <button type="button" class="button button-danger" onclick="this.form.reset()">取消</button>
          </div>
        </form>
      </div>
    </div>

    <div id="edit" class="page">
      <h2>編輯客戶</h2>
      <!-- 編輯客戶的內容將在此處添加 -->
    </div>

    <div id="contract" class="page">
      <h2>合約產製</h2>
      <div class="contract-form">
        <form id="generate-contract-form">
          <label>客戶姓名：<input type="text" name="customerName" required></label>
          <label>身分證字號：<input type="text" name="idNumber" required></label>
          <label>手機型號：<input type="text" name="phoneModel" required></label>
          <label>買賣價金：<input type="number" name="price" required></label>
          <label>週租金：<input type="number" name="weeklyRent" required></label>
          <label>合約起始日：<input type="date" name="startDate" required></label>
          <button type="submit">產生合約</button>
        </form>
      </div>
      <div class="contract-preview" style="display:none;">
        <h3>合約預覽</h3>
        <iframe id="contract-preview-frame"></iframe>
        <button id="download-contract">下載合約</button>
      </div>
    </div>
  </div>

  <script>
    // 初始化頁面
    document.addEventListener('DOMContentLoaded', function() {
      showPage('dashboard');
    });

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    // ... existing code ...

    // 合約產製功能
    document.getElementById('generate-contract-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      fetch('/api/contracts/generate', {
        method: 'POST',
        body: formData
      })
      .then(response => response.blob())
      .then(blob => {
        const previewFrame = document.getElementById('contract-preview-frame');
        const previewDiv = document.querySelector('.contract-preview');
        previewDiv.style.display = 'block';
        previewFrame.src = URL.createObjectURL(blob);
      })
      .catch(error => alert('合約產生失敗'));
    });

    document.getElementById('download-contract').addEventListener('click', function() {
      const previewFrame = document.getElementById('contract-preview-frame');
      const link = document.createElement('a');
      link.href = previewFrame.src;
      link.download = '合約.pdf';
      link.click();
    });
  </script>
</body>
</html>
