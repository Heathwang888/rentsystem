<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ‰‹æ©Ÿç§Ÿè³ƒå¾Œå°ç³»çµ±</title>
  <style>
    body { margin: 0; font-family: 'Noto Sans TC', sans-serif; }
    .sidebar { width: 200px; height: 100vh; background: #333; color: #fff; position: fixed; top: 0; left: 0; display: flex; flex-direction: column; }
    .sidebar button { background: none; border: none; color: #fff; padding: 20px; text-align: left; cursor: pointer; font-size: 16px; }
    .sidebar button:hover { background: #444; }
    .page-content { margin-left: 200px; padding: 20px; }
    .page { display: none; }
    .page.active { display: block; }
    form label { display: block; margin: 10px 0; }
    input, select { margin-left: 10px; }
  </style>
</head>
<body>

  <div class="sidebar">
    <button onclick="showPage('dashboard')">ğŸ“Š ç¸½è¦½</button>
    <button onclick="showPage('list')">ğŸ“ å®¢æˆ¶åˆ—è¡¨</button>
    <button onclick="showPage('add')">â• æ–°å¢å®¢æˆ¶</button>
    <button onclick="showPage('edit')">âœï¸ ç·¨è¼¯å®¢æˆ¶</button>
    <button onclick="showPage('contract')">ğŸ“„ åˆç´„ç”¢è£½</button>
  </div>
  </div>

  <div class="page-content">
    <div id="dashboard" class="page active">
      <h2>ç¸½è¦½é ï¼ˆå°šæœªè£½ä½œï¼‰</h2>
    </div>

    <div id="list" class="page">
<!-- å®¢æˆ¶åˆ—è¡¨é  HTML ç‰‡æ®µ -->
<div class="filter-bar">
  <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
  <button class="filter-btn" data-filter="active">ç§Ÿè³ƒä¸­</button>
  <button class="filter-btn" data-filter="bought">å·²è²·å›</button>
  <button class="filter-btn" data-filter="locked">å‘†å¸³</button>
</div>

<div class="customer-list">
  <div class="customer-card" data-status="active">
    <div class="card-header">
      <div class="card-top">
        <strong>å¼µä¸‰</strong>
        <span class="note-tag">ï¼ˆå‚™è¨»å­—çœ¼ï¼‰</span>
        <div class="right-section">
          <span class="balance-info">å°šæœ‰é¤˜é¡ $1,000 å…ƒ</span>
          <span class="status-tag">ç§Ÿè³ƒä¸­</span>
          <span class="due-today">æœ¬æ—¥æ‡‰ç¹³æ¬¾</span>
        </div>
      </div>
      <div class="card-summary">
        <span>iPhone 13</span> ï½œ 
        <span>åƒ¹é‡‘ï¼š$6,000</span> ï½œ 
        <span>ç§Ÿé‡‘ï¼š$1,500</span>
        <button class="pay-btn">ç¹³æ¬¾</button>
      </div>
      <button class="toggle-detail">â–¼ å±•é–‹</button>
    </div>

    <div class="card-detail" style="display:none;">
      <p><strong>æ‰‹æ©Ÿè™Ÿç¢¼ï¼š</strong>0900-123-456</p>
      <p><strong>èº«åˆ†è­‰å­—è™Ÿï¼š</strong>A123456789</p>
      <p><strong>æ‰‹æ©Ÿå‹è™Ÿï¼š</strong>iPhone 13</p>
      <p><strong>IMEIï¼š</strong>356789012345678</p>
      <p><strong>åºè™Ÿï¼š</strong>XYZ12345678</p>
      <p><strong>æˆ¶ç±åœ°å€ï¼š</strong>é«˜é›„å¸‚è‹“é›…å€å…‰è¯ä¸€è·¯123è™Ÿ</p>
      <p><strong>é€šè¨Šåœ°å€ï¼š</strong>åŒä¸Š</p>
      <p><strong>åˆç´„èµ·å§‹æ—¥ï¼š</strong>2025/05/01</p>
      <p><strong>è²·è³£åƒ¹é‡‘ï¼š</strong>$6,000</p>
      <p><strong>ç§Ÿé‡‘ï¼š</strong>$1,500 / é€±</p>
      <p><strong>æ’¥æ¬¾å¸³æˆ¶ï¼š</strong>ç¬¬ä¸€éŠ€è¡Œ é«˜é›„åˆ†è¡Œ / æˆ¶åï¼šå¼µä¸‰ / å¸³è™Ÿï¼š123-456789-001</p>
      <p><strong>æ­·å²ç¹³æ¬¾ç´€éŒ„ï¼š</strong></p>
      <ul>
        <li>2025/05/01 - $1,500</li>
      </ul>
      <p><strong>å‚™è¨»ï¼š</strong> 
        <input type="text" class="note-input" placeholder="è¼¸å…¥å‚™è¨»..." value="">
        <button class="save-note">ç¢ºèª</button>
      </p>

      <div class="card-actions">
        <button class="download-contract">ä¸‹è¼‰åˆç´„</button>
        <button class="download-id">ä¸‹è¼‰èº«åˆ†è­‰</button>
        <button class="download-disbursement">ä¸‹è¼‰æ’¥æ¬¾æ°´å–®</button>
        <button class="mark-locked">å‘†å¸³(é–æ©Ÿ)</button>
      </div>
    </div>
  </div>
</div>

<!-- ç¹³æ¬¾å½ˆçª— -->
<div id="payment-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h3>ç¹³æ¬¾ç´€éŒ„</h3>
    <label>ç¹³æ¬¾é‡‘é¡ï¼š</label>
    <input type="number" id="payment-amount" placeholder="è«‹è¼¸å…¥é‡‘é¡">
    <button id="submit-payment">ç¢ºèªç¹³æ¬¾</button>
  </div>
</div>

<script>
  // åˆ‡æ›å±•é–‹ / æ”¶åˆ
  document.querySelectorAll('.toggle-detail').forEach(btn => {
    btn.addEventListener('click', () => {
      const detail = btn.closest('.customer-card').querySelector('.card-detail');
      detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
    });
  });

  // ç¯©é¸é‚è¼¯
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const filter = btn.dataset.filter;
      document.querySelectorAll('.customer-card').forEach(card => {
        card.style.display = (filter === 'all' || card.dataset.status === filter) ? 'block' : 'none';
      });
    });
  });

  // å½ˆå‡ºç¹³æ¬¾è¦–çª—
  document.querySelectorAll('.pay-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('payment-modal').style.display = 'block';
    });
  });

  // é—œé–‰è¦–çª—
  document.querySelector('.close-modal').addEventListener('click', () => {
    document.getElementById('payment-modal').style.display = 'none';
  });
</script>

<style>
  .customer-card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    background: #fff;
  }
  .card-header {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .card-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .right-section span {
    margin-left: 10px;
  }
  .card-summary {
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
  }
  .card-actions button {
    margin-right: 10px;
  }
  .filter-bar button.active {
    background: #f3cc00;
  }
  .note-input {
    width: 200px;
  }
  .modal {
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
  }
  .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 300px;
    border-radius: 8px;
  }
  .close-modal {
    float: right;
    cursor: pointer;
  }
</style>


    <div id="add" class="page">
      <!-- æ–°å¢å®¢æˆ¶é  HTML ç‰‡æ®µ -->
      <h2>æ–°å¢å®¢æˆ¶</h2>
 <form id="add-customer-form" enctype="multipart/form-data">
  <label>å§“åï¼š<input type="text" name="name" required></label><br>
  <label>èº«åˆ†è­‰å­—è™Ÿï¼š<input type="text" name="idNumber" required></label><br>
  <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼š<input type="text" name="mobile" required></label><br>
  <label>æˆ¶ç±åœ°å€ï¼š<input type="text" name="registeredAddress" required></label><br>
  <label>ç¾å±…åœ°å€ï¼š<input type="text" name="currentAddress" id="currentAddress"></label>
  <label><input type="checkbox" id="sameAsRegistered"> åŒæˆ¶ç±åœ°å€</label><br>

  <label>æ‰‹æ©Ÿå‹è™Ÿï¼š
    <select name="model">
      <option>iPhone 12</option>
      <option>iPhone 12 mini</option>
      <option>iPhone 12 Pro</option>
      <option>iPhone 12 Pro Max</option>
      <option>iPhone 13</option>
      <option>iPhone 13 mini</option>
      <option>iPhone 13 Pro</option>
      <option>iPhone 13 Pro Max</option>
      <option>iPhone 14</option>
      <option>iPhone 14 Plus</option>
      <option>iPhone 14 Pro</option>
      <option>iPhone 14 Pro Max</option>
      <option>iPhone 15</option>
      <option>iPhone 15 Plus</option>
      <option>iPhone 15 Pro</option>
      <option>iPhone 15 Pro Max</option>
      <option>iPhone 16 </option>
      <option>iPhone 16 e</option>
      <option>iPhone 16 Plus</option>
      <option>iPhone 16 Pro</option>
      <option>iPhone 16 Pro Max</option>
    </select>
  </label><br>
        <label>IMEIï¼š<input type="text" name="imei" required></label>
        <label>åºè™Ÿï¼š<input type="text" name="serialNumber" required></label>
        <label>è²·è³£åƒ¹ï¼š<input type="number" name="price" required></label>
        <label>é€±ç§Ÿé‡‘ï¼š<input type="number" name="rent" required></label>
        <label>æ”¶æ¬¾å¸³æˆ¶éŠ€è¡Œï¼š<input type="text" name="bank" required></label>
        <label>æˆ¶åï¼š<input type="text" name="bankAccountName" required></label>
        <label>å¸³è™Ÿï¼š<input type="text" name="bankAccountNumber" required></label>
        <label>åˆç´„èµ·å§‹æ—¥ï¼š<input type="date" name="contractDate" id="contractDate" required></label>
        <label>åˆç´„ PDFï¼š<input type="file" name="contractPdf" accept="application/pdf"></label>
        <label>èº«åˆ†è­‰æ­£é¢ï¼š<input type="file" name="idFront" accept="image/*"></label>
        <label>èº«åˆ†è­‰åé¢ï¼š<input type="file" name="idBack" accept="image/*"></label>
        <label>æ’¥æ¬¾æ°´å–®ï¼š<input type="file" name="paymentSlip" accept="image/*,application/pdf"></label>
        <button type="submit">é€å‡ºæ–°å¢</button>
      </form>
    </div>

    <div id="edit" class="page">
      <h2>ç·¨è¼¯å®¢æˆ¶è³‡æ–™</h2>
      <input type="text" id="searchKeyword" placeholder="è¼¸å…¥å§“åæˆ–èº«åˆ†è­‰å­—è™Ÿ">
      <button onclick="searchCustomer()">æœå°‹</button>
      <form id="edit-form" style="display:none;">
        <input type="hidden" name="id">
        <label>å§“åï¼š<input type="text" name="name" required></label>
        <label>èº«åˆ†è­‰å­—è™Ÿï¼š<input type="text" name="idNumber" required></label>
        <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼š<input type="text" name="mobile" required></label>
        <label>æˆ¶ç±åœ°å€ï¼š<input type="text" name="registeredAddress" required></label>
        <label>ç¾å±…åœ°å€ï¼š<input type="text" name="currentAddress"></label>
        <label>æ‰‹æ©Ÿå‹è™Ÿï¼š<input type="text" name="model"></label>
        <label>IMEIï¼š<input type="text" name="imei"></label>
        <label>åºè™Ÿï¼š<input type="text" name="serialNumber"></label>
        <label>è²·è³£åƒ¹ï¼š<input type="number" name="price"></label>
        <label>é€±ç§Ÿé‡‘ï¼š<input type="number" name="rent"></label>
        <label>æ”¶æ¬¾å¸³æˆ¶éŠ€è¡Œï¼š<input type="text" name="bank"></label>
        <label>æˆ¶åï¼š<input type="text" name="bankAccountName"></label>
        <label>å¸³è™Ÿï¼š<input type="text" name="bankAccountNumber"></label>
        <label>åˆç´„èµ·å§‹æ—¥ï¼š<input type="text" name="contractDate"></label>
        <button type="submit">ç¢ºèªä¿®æ”¹</button>
      </form>
    </div>

    <div id="contract" class="page">
      <h2>åˆç´„ç”¢è£½ï¼ˆç©ºç™½é ï¼‰</h2>
    </div>
  </div>

  <script>
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    document.getElementById('sameAsRegistered').addEventListener('change', function () {
      const reg = document.querySelector('[name="registeredAddress"]');
      const cur = document.getElementById('currentAddress');
      if (this.checked) cur.value = reg.value;
    });

    function toROC(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear() - 1911;
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      return ${year}/${month}/${day};
    }

    document.getElementById('add-customer-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = this;
      const formData = new FormData(form);
      const rocDate = toROC(document.getElementById('contractDate').value);
      formData.set('contractDate', rocDate);
      fetch('/api/customers/create', { method: 'POST', body: formData })
        .then(res => res.json()).then(() => alert('æ–°å¢æˆåŠŸ'))
        .catch(() => alert('ä¸Šå‚³å¤±æ•—'));
    });

    function searchCustomer() {
      const keyword = document.getElementById('searchKeyword').value;
      fetch(/api/customers/search?keyword=${encodeURIComponent(keyword)})
        .then(res => res.json())
        .then(data => {
          const form = document.getElementById('edit-form');
          form.style.display = 'block';
          for (const key in data) {
            if (form[key]) form[key].value = data[key];
          }
        }).catch(() => alert('æŸ¥ç„¡è³‡æ–™'));
    }

    document.getElementById('edit-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const id = formData.get('id');
      fetch(/api/customers/update/${id}, { method: 'PATCH', body: formData })
        .then(res => res.json()).then(() => alert('ä¿®æ”¹æˆåŠŸ'))
        .catch(() => alert('ä¿®æ”¹å¤±æ•—'));
    });
  </script>
   function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    // é¿å… JS éŒ¯èª¤ä¸­æ–·
    document.addEventListener('DOMContentLoaded', () => {
      const sameBox = document.getElementById('sameAsRegistered');
      if (sameBox) {
        sameBox.addEventListener('change', () => {
          const reg = document.querySelector('[name="registeredAddress"]');
          const cur = document.getElementById('currentAddress');
          if (sameBox.checked) cur.value = reg.value;
        });
      }

      document.getElementById('add-customer-form').addEventListener('submit', e => {
        e.preventDefault();
        alert('æ–°å¢æˆåŠŸ (æ¨¡æ“¬é€å‡º)');
      });
    });
  </script>

</body>
</html>
